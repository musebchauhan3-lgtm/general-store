<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Danis ProSell Market</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --purple:#6a11cb;
  --blue:#2575fc;
  --bg:#f4f6fb;
  --card:#ffffff;
}
body{margin:0;font-family:Segoe UI,Arial;background:var(--bg);}
header{
  background:linear-gradient(135deg,var(--purple),var(--blue));
  color:#fff;padding:15px;text-align:center;
}
nav button{
  margin:5px;padding:10px 15px;
  border:none;border-radius:20px;
  cursor:pointer;
}
section{display:none;padding:15px;}
.active{display:block;}
.card{
  background:var(--card);
  padding:15px;border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
  margin-bottom:15px;
}
input, textarea{
  width:100%;padding:10px;margin:5px 0;
  border-radius:8px;border:1px solid #ccc;
}
button.action{
  background:linear-gradient(135deg,var(--purple),var(--blue));
  color:#fff;padding:8px 12px;
  border:none;border-radius:8px;cursor:pointer;
}
.order{
  background:#eef0ff;padding:10px;
  border-radius:8px;margin:10px 0;
}
.danger{
  background:#ff4d4d;color:#fff;border:none;
  padding:6px 10px;border-radius:8px;cursor:pointer;
}
canvas{
  background:#fff;
  border-radius:12px;
  padding:10px;
  box-shadow:0 5px 15px rgba(0,0,0,.1);
}
</style>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<header>
<h1>ğŸ›’ Danis ProSell Market</h1>
<nav>
<button onclick="show('customer')">Customer</button>
<button onclick="show('seller')">Seller</button>
<button onclick="show('admin')">Admin</button>
</nav>
</header>

<!-- CUSTOMER -->
<section id="customer" class="active">
<h2>Customer Shop</h2>
<div id="products"></div>

<div class="card">
<h3>ğŸ›’ Cart</h3>
<div id="cart"></div>
<div id="cartTotal"></div>

<input id="cname" placeholder="Customer Name">
<input id="cphone" placeholder="Phone Number">
<textarea id="caddress" placeholder="Address"></textarea>
<button class="action" onclick="placeOrder()">Place Order</button>
</div>

<div class="card">
<h3>ğŸ“¦ My Orders</h3>
<input id="searchPhone" placeholder="Enter Phone to See Orders">
<button class="action" onclick="renderCustomerOrders()">Show My Orders</button>
<div id="customerOrders"></div>
</div>
</section>

<!-- SELLER -->
<section id="seller">
<h2>Seller Panel</h2>

<div class="card">
<h3>ğŸ“Š Today Sales Total</h3>
<div id="sellerSales"></div>
</div>

<div class="card">
<h3>ğŸ“… Monthly Sales Total</h3>
<div id="sellerMonthRange"></div>
<div id="sellerMonthSales"></div>
</div>

<div class="card">
<h3>Add Product</h3>
<input id="pname" placeholder="Product Name">
<input id="pprice" placeholder="Price">
<textarea id="pdesc" placeholder="Description"></textarea>
<button class="action" onclick="addProduct()">Add Product</button>
</div>

<div class="card">
<h3>Your Products</h3>
<div id="sellerProducts"></div>
</div>

<div class="card">
<h3>Orders</h3>
<div id="sellerOrders"></div>
</div>

<div class="card">
<h3>ğŸ“… Custom Date Sales</h3>
From: <input type="date" id="sellerFrom">
To: <input type="date" id="sellerTo">
<button class="action" onclick="sellerFilter()">Check</button>
<div id="sellerFilterTotal"></div>
</div>

<div class="card">
<h3>ğŸ“ˆ Sales Graph</h3>
<button class="action" onclick="drawGraph(7)">Last 7 Days</button>
<button class="action" onclick="drawGraph(30)">Last 30 Days</button>
<canvas id="sellerChart" width="400" height="200"></canvas>
</div>
</section>

<!-- ADMIN -->
<section id="admin">
<h2>Admin Panel</h2>

<div class="card">
<h3>ğŸ“Š Today Sales Total</h3>
<div id="adminSales"></div>
</div>

<div class="card">
<h3>ğŸ“… Monthly Sales Total</h3>
<div id="adminMonthRange"></div>
<div id="adminMonthSales"></div>
</div>

<div class="card">
<h3>All Orders</h3>
<button class="danger" onclick="clearAllOrders()">ğŸ—‘ Delete All Orders</button>
<button class="action" onclick="downloadExcel()">â¬‡ Download Excel</button>
<div id="adminOrders"></div>
</div>

<div class="card">
<h3>ğŸ“… Custom Date Sales</h3>
From: <input type="date" id="adminFrom">
To: <input type="date" id="adminTo">
<button class="action" onclick="adminFilter()">Check</button>
<button class="action" onclick="downloadExcelFiltered(adminFrom.value,adminTo.value)">â¬‡ Filter Excel</button>
<div id="adminFilterTotal"></div>
</div>

<div class="card">
<h3>ğŸ“ˆ Sales Graph</h3>
<button class="action" onclick="drawGraphAdmin(7)">Last 7 Days</button>
<button class="action" onclick="drawGraphAdmin(30)">Last 30 Days</button>
<canvas id="adminChart" width="400" height="200"></canvas>
</div>
</section>

<script>
const productsDiv = document.getElementById("products");
const cartDiv = document.getElementById("cart");
const cartTotalDiv = document.getElementById("cartTotal");
const sellerProducts = document.getElementById("sellerProducts");
const sellerOrders = document.getElementById("sellerOrders");
const adminOrders = document.getElementById("adminOrders");
const customerOrdersDiv = document.getElementById("customerOrders");

let products = JSON.parse(localStorage.getItem("products")||"[]");
let orders = JSON.parse(localStorage.getItem("orders")||"[]");
let cart = [];
let sellerChart, adminChart;

function show(id){
  if(id === "seller" && prompt("Enter Seller Password")!=="Danis12345") return alert("Wrong Seller Password");
  if(id === "admin" && prompt("Enter Admin Password")!=="Museb98765") return alert("Wrong Admin Password");
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  render();
}

function save(){
  localStorage.setItem("products",JSON.stringify(products));
  localStorage.setItem("orders",JSON.stringify(orders));
}

function addProduct(){
  products.push({id:Date.now(),name:pname.value,price:Number(pprice.value),desc:pdesc.value});
  pname.value=pprice.value=pdesc.value="";
  save(); render();
}

function getTodaySales(){
  let today = new Date().toDateString(), total=0;
  orders.forEach(o=>{
    if(new Date(o.date).toDateString()===today && o.status==="Completed")
      o.items.forEach(i=>total+=i.price*i.qty);
  });
  return total;
}

function getMonthSales(){
  const now=new Date(); let total=0;
  orders.forEach(o=>{
    const d=new Date(o.date);
    if(d.getMonth()===now.getMonth() && d.getFullYear()===now.getFullYear() && o.status==="Completed")
      o.items.forEach(i=>total+=i.price*i.qty);
  });
  return total;
}

function getMonthRangeText(){
  const now=new Date();
  const start=new Date(now.getFullYear(),now.getMonth(),1);
  const opt={day:"2-digit",month:"short",year:"numeric"};
  return start.toLocaleDateString("en-IN",opt) + " â€” " + now.toLocaleDateString("en-IN",opt);
}

function getRangeSales(from,to){
  if(!from || !to) return 0;
  const f=new Date(from), t=new Date(to); t.setHours(23,59,59,999); let total=0;
  orders.forEach(o=>{
    const d=new Date(o.date);
    if(d>=f && d<=t && o.status==="Completed")
      o.items.forEach(i=>total+=i.price*i.qty);
  });
  return total;
}

function sellerFilter(){
  const from=sellerFrom.value, to=sellerTo.value;
  document.getElementById("sellerFilterTotal").innerHTML="Total Sales: â‚¹ " + getRangeSales(from,to);
}

function adminFilter(){
  const from=adminFrom.value, to=adminTo.value;
  document.getElementById("adminFilterTotal").innerHTML="Total Sales: â‚¹ " + getRangeSales(from,to);
}

function render(){
  // Products
  productsDiv.innerHTML=""; products.forEach(p=>{
    productsDiv.innerHTML+=`<div class="card"><b>${p.name}</b><br>â‚¹${p.price}<br>${p.desc}<br><button class="action" onclick="addToCart(${p.id})">Add to Cart</button></div>`;
  });

  // Cart
  let total=0; cartDiv.innerHTML="";
  cart.forEach(c=>{
    total+=c.price*c.qty;
    cartDiv.innerHTML+=`<div class="card">${c.name} â‚¹${c.price} Ã— ${c.qty}<button onclick="qty(${c.id},-1)">âˆ’</button><button onclick="qty(${c.id},1)">+</button></div>`;
  });
  cartTotalDiv.innerHTML="Total â‚¹"+total;

  // Seller Products
  sellerProducts.innerHTML="";
  products.forEach(p=>sellerProducts.innerHTML+=`${p.name} â‚¹${p.price}<button onclick="delProd(${p.id})">âŒ</button><br>`);

  document.getElementById("sellerSales").innerHTML="â‚¹ "+getTodaySales();
  document.getElementById("adminSales").innerHTML="â‚¹ "+getTodaySales();
  document.getElementById("sellerMonthSales").innerHTML="â‚¹ "+getMonthSales();
  document.getElementById("adminMonthSales").innerHTML="â‚¹ "+getMonthSales();
  document.getElementById("sellerMonthRange").innerHTML="From: "+getMonthRangeText();
  document.getElementById("adminMonthRange").innerHTML="From: "+getMonthRangeText();

  sellerOrders.innerHTML=""; adminOrders.innerHTML="";
  orders.forEach(o=>{
    let items=o.items.map(i=>`${i.name} x${i.qty}`).join(", ");
    let box=`<div class="order"><b>${o.name}</b> | ${o.phone}<br><b>Address:</b> ${o.address}<br><b>Items:</b> ${items}<br><b>Status:</b> ${o.status}<br><b>Date:</b> ${o.date}<br><button onclick="updateStatus(${o.id},'Completed')" class="action">âœ” Complete</button><button onclick="updateStatus(${o.id},'Cancelled')" class="danger">âŒ Cancel</button></div>`;
    sellerOrders.innerHTML+=box; adminOrders.innerHTML+=box;
  });

  drawGraph(7);
  drawGraphAdmin(7);
}

// GRAPH FUNCTIONS
function getDailySales(days){
  const labels=[], data=[];
  for(let i=days-1;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    labels.push(d.toLocaleDateString("en-IN",{day:"2-digit",month:"short"}));
    let total=0;
    orders.forEach(o=>{
      const od=new Date(o.date);
      if(od.toDateString()===d.toDateString() && o.status==="Completed")
        o.items.forEach(it=>total+=it.price*it.qty);
    });
    data.push(total);
  }
  return {labels,data};
}

function drawGraph(days){
  const ctx=document.getElementById('sellerChart').getContext('2d');
  const d=getDailySales(Number(days));
  if(sellerChart) sellerChart.destroy();
  sellerChart=new Chart(ctx,{
    type:'line',
    data:{labels:d.labels,datasets:[{label:'Sales',data:d.data,fill:false,borderColor:'#2575fc',tension:0.3,pointBackgroundColor:'#2575fc',pointHoverRadius:7}]},
    options:{
      responsive:true,
      plugins:{
        legend:{display:true},
        tooltip:{
          callbacks:{
            label:function(ctx){return "â‚¹ "+ctx.raw;},
            title:function(ctx){return "Date: "+ctx[0].label;}
          }
        }
      },
      scales:{y:{ticks:{callback:function(v){return "â‚¹ "+v;}}}}
    }
  });
}

function drawGraphAdmin(days){
  const ctx=document.getElementById('adminChart').getContext('2d');
  const d=getDailySales(Number(days));
  if(adminChart) adminChart.destroy();
  adminChart=new Chart(ctx,{
    type:'line',
    data:{labels:d.labels,datasets:[{label:'Sales',data:d.data,fill:false,borderColor:'#6a11cb',tension:0.3,pointBackgroundColor:'#6a11cb',pointHoverRadius:7}]},
    options:{
      responsive:true,
      plugins:{
        legend:{display:true},
        tooltip:{
          callbacks:{
            label:function(ctx){return "â‚¹ "+ctx.raw;},
            title:function(ctx){return "Date: "+ctx[0].label;}
          }
        }
      },
      scales:{y:{ticks:{callback:function(v){return "â‚¹ "+v;}}}}
    }
  });
}

// REST FUNCTIONS (unchanged)
function downloadExcel(){let rows=[["ID","Date","Name","Phone","Address","Items","Total","Status"]];orders.forEach(o=>{let total=0;let items=o.items.map(i=>{total+=i.price*i.qty;return i.name+" x"+i.qty;}).join(" | ");rows.push([o.id,o.date,o.name,o.phone,o.address,items,total,o.status]);});let csv=rows.map(r=>r.join(",")).join("\n");let blob=new Blob([csv],{type:"text/csv"});let url=URL.createObjectURL(blob);let a=document.createElement("a");a.href=url;a.download="orders.csv";a.click();}
function downloadExcelFiltered(from,to){if(!from||!to)return alert("Select dates");const f=new Date(from),t=new Date(to);t.setHours(23,59,59,999);let rows=[["ID","Date","Name","Phone","Address","Items","Total","Status"]];orders.forEach(o=>{const d=new Date(o.date);if(d>=f&&d<=t){let total=0;let items=o.items.map(i=>{total+=i.price*i.qty;return i.name+" x"+i.qty;}).join(" | ");rows.push([o.id,o.date,o.name,o.phone,o.address,items,total,o.status]);}});let csv=rows.map(r=>r.join(",")).join("\n");let blob=new Blob([csv],{type:"text/csv"});let url=URL.createObjectURL(blob);let a=document.createElement("a");a.href=url;a.download="filtered_orders.csv";a.click();}
function addToCart(id){let p=products.find(x=>x.id===id);let c=cart.find(x=>x.id===id);c?c.qty++:cart.push({...p,qty:1});render();}
function qty(id,v){let c=cart.find(x=>x.id===id);c.qty+=v;if(c.qty<=0) cart=cart.filter(x=>x.id!==id);render();}
function placeOrder(){if(!cart.length)return alert("Cart empty");orders.push({id:Date.now(),name:cname.value,phone:cphone.value,address:caddress.value,date:new Date().toString(),items:JSON.parse(JSON.stringify(cart)),status:"Pending"});cart=[];cname.value=cphone.value=caddress.value="";save();render();alert("Order Placed");}
function renderCustomerOrders(){const phone=searchPhone.value;customerOrdersDiv.innerHTML="";orders.filter(o=>o.phone===phone).forEach(o=>{let total=0;let items=o.items.map(i=>{total+=i.price*i.qty;return `${i.name} x${i.qty}`}).join(", ");customerOrdersDiv.innerHTML+=`<div class="order">Date:${o.date}<br>Items:${items}<br>Total:â‚¹${total}<br>Status:<b>${o.status}</b><br>${o.status==="Pending"?`<button class="danger" onclick="cancelByCustomer(${o.id})">Cancel</button>`:""}</div>`});}
function cancelByCustomer(id){orders.find(x=>x.id===id).status="Cancelled";save();renderCustomerOrders();render();}
function updateStatus(id,status){orders.find(x=>x.id===id).status=status;save();render();}
function delProd(id){products=products.filter(p=>p.id!==id);save();render();}
function clearAllOrders(){orders=[];localStorage.removeItem("orders");save();render();}

render();
</script>
</body>
</html>